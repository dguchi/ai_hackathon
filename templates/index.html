<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        #message {
            position: relative;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
        }
        #button_area{
            position: absolute;
            top: 65%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>

</head>
<body>
    <div class="max-w-md mx-auto my-4">
        ペルソナ設定
        <form id="my-form" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" action="/submit" method="post">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="industry">
                    業界選択
                </label>
                <input
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="industry"
                    type="text"
                    placeholder="業界を選択してください"
                    list="industry-list"
                    name="industry"
                >
                <datalist id="industry-list">
                    <option value="メーカー">
                    <option value="商社">
                    <option value="小売">
                    <option value="ソフトウエア">
                    <option value="サービス">
                    <option value="マスコミ">
                    <option value="金融業">
                    <option value="公共団体">
                </datalist>
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="password">
                    ターゲット
                </label>
                <input
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline"
                    id="target"
                    type="text"
                    placeholder="ターゲットを入力してください"
                    list="target-list"
                    name="target"
                >
                <datalist id="target-list">
                    <option value="経営者">
                    <option value="責任者">
                    <option value="マネージャー">
                    <option value="作業員">
                    <option value="消費者">
                </datalist>
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">
                    性別
                </label>
                <div class="mt-2">
                <label class="inline-flex items-center">
                    <input type="radio" class="form-radio text-blue-500" name="gender" value="male" checked>
                    <span class="ml-2">男性</span>
                </label>
                <label class="inline-flex items-center ml-6">
                    <input type="radio" class="form-radio text-blue-500" name="gender" value="female">
                    <span class="ml-2">女性</span>
                </label>
                <label class="inline-flex items-center ml-6">
                    <input type="radio" class="form-radio text-blue-500" name="gender" value="other">
                    <span class="ml-2">その他</span>
                </label>
                </div>
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-bold mb-2">
                    イメージ色
                </label>
                <input
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="color"
                    type="text"
                    placeholder="イメージ色を入力してください"
                    list="color-list"
                    name="color"
                >
                <datalist id="color-list">
                    <option value="赤">
                    <option value="青">
                    <option value="緑">
                    <option value="黄色">
                    <option value="オレンジ">
                    <option value="ピンク">
                    <option value="橙">
                    <option value="紫">
                    <option value="水色">
                    <option value="黄緑">
                    <option value="茶色">
                    <option value="白">
                    <option value="藍">
                </datalist>
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-bold mb-2">
                    年齢
                </label>
                <input
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="age"
                    type="number"
                    placeholder="年齢を入力してください"
                    name="age"
                >
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-bold mb-2">
                    サービス概要
                </label>
                <input
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="detail"
                    type="text"
                    placeholder="サービス概要を入力してください"
                    name="detail"
                >
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-bold mb-2">
                    参照ページ
                </label>
                <input
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="url"
                    type="text"
                    placeholder="参照ページURLを入力してください"
                    name="url"
                >
            </div>
            <div class="flex items-center justify-between">
                <button
                    id="submit-btn"
                    class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                    type="button"
                    disabled
                >
                作成する
                </button>
            </div>
            <input id="catchcopy" type="hidden" name="catchcopy" value="dummy4send_button" />
        </form>
    </div>
    <!--  リトライ用画面  -->
    <div id="overlay">
        <div id="message"></div>
        <div id="button_area">
            <button id="ok-btn" class="py-2 px-4 bg-blue-500 hover:bg-blue-700 text-white">OK</button>
            <button id="retry-btn" class="py-2 px-4 bg-blue-500 hover:bg-blue-700 text-white">リトライ</button>
        </div> 
    </div>
    <script>
        const form = document.getElementById('my-form');
 
        document.addEventListener('DOMContentLoaded', (event) => {
            const inputs = form.querySelectorAll('input');
            const submitBtn = document.getElementById('submit-btn');

            function checkInputs() {
                let allFilled = true;
                inputs.forEach(input => {
                    if (input.value.trim() === '') {
                        allFilled = false;
                    }
                });

                submitBtn.disabled = !allFilled;
                if (allFilled) {
                    submitBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    submitBtn.classList.add('bg-blue-500', 'hover:bg-blue-700', 'cursor-pointer');
                } else {
                    submitBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                    submitBtn.classList.remove('bg-blue-500', 'hover:bg-blue-700', 'cursor-pointer');
                }
            }

            inputs.forEach(input => {
                input.addEventListener('input', checkInputs);
            });

            checkInputs();
        });
    </script>
    <script>
        const submitBtn = document.getElementById('submit-btn');
        const okBtn = document.getElementById('ok-btn');
        const retryBtn = document.getElementById('retry-btn');

        submitBtn.addEventListener('click', (event) => {
            createCatchCopy();
        })
        
        function btnDisabled(btnArray){
            btnArray.map((btn) => {
                btn.disabled = true
                btn.classList.remove('bg-blue-500');
                btn.classList.add('bg-gray-400', 'cursor-not-allowed');
            })
        }

        function btnEnabled(btnArray){
            btnArray.map((btn) => {
                btn.disabled = false
                btn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                btn.classList.add('bg-blue-500', 'hover:bg-blue-700', 'cursor-pointer');
            })
        }

        function showOverlay(text) {
            const overlay = document.getElementById('overlay');
            const message = document.getElementById('message');
            message.textContent = text;
            overlay.style.display = 'block';

           // setTimeout(() => {
           //     overlay.style.display = 'none';
           //     form.submit();
           // }, 30000);
        }

        function createCatchCopy(){
            const form = document.getElementById('my-form');
            const formData = new FormData(form);

            fetch('/createCatchcopy', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('Success:', data);
                document.getElementById('catchcopy').value=data.catchcopy;
  
                btnEnabled([okBtn,retryBtn])
                showOverlay(data.catchcopy);    
            })
            .catch((error) => {
                console.error('Error:', error);
            });     
        }

        okBtn.addEventListener( 'click',(event)=> {
            btnDisabled([okBtn,retryBtn])
            form.submit();
        })

        retryBtn.addEventListener('click', (event) => {
            btnDisabled([okBtn,retryBtn])
            createCatchCopy();
        })
    </script>
</body>
</html>